# Презентация проекта: Поиск фильмов (веб + CLI) с логированием запросов

Проект реализует систему поиска фильмов с двумя интерфейсами — веб‑приложением на 
Flask и консольным клиентом (CLI) — и собирает логи запросов в MongoDB для последующей аналитики.

Описание проекта и цель
Проект предоставляет пользователю удобный поиск фильмов по ключевому слову и по жанру с возможностью 
указания диапазона годов выпуска. 
Интерфейсы:
- Веб: поисковые страницы и страница статистики (топ популярных и последние уникальные запросы).
- CLI: меню для интерактивного поиска и просмотра статистики, с постраничным выводом результатов.

Технологии
- Python 3.8+
- Flask (Jinja2) — веб‑интерфейс
- MySQL (через mysql_connector) — источник данных о фильмах
- MongoDB (pymongo) — хранение логов запросов
- CLI — стандартный ввод/вывод, модуль formatter для вывода
- Поддерживающие модули: pathlib, logging, конфигурация в local_settings


Соответствие техническому заданию
- Функционал поиска реализован для обоих интерфейсов (веб и CLI): поиск по ключевому слову и по жанру + диапазону годов.  
- Логирование пользовательских запросов в MongoDB реализовано: сохраняются тип запроса, параметры и количество результатов.  
- Страница статистики: топ популярных и последние уникальные запросы реализованы посредством отдельного модуля логики (log_stats).  



Структура проекта

final_project1/
  .gitignore                     # Файлы/папки, игнорируемые Git
  .env                           # Переменные окружения 
  README.md                      # Документация проекта
  requirements.txt               # Зависимости Python
  local_settings.py              # Конфигурация (DB URIs, PAGE_SIZE, Mongo/SQL)

  app/
    formatter.py                 # Форматирование вывода для CLI (таблицы/списки)
    log_stats.py                 # Чтение агрегатов из MongoDB (топ/последние запросы)
    log_writer.py                # Запись логов поисковых запросов в MongoDB
    cli.py                       # CLI — точка входа, paginate_loop и меню
    mysql_connector.py           # Доступ к MySQL: запросы, поиск, справочные данные
    web_app.py                   # Flask‑приложение: маршруты, рендеринг, вызовы логирования

  static/                        # Статические файлы (css, изображения)
    └─ logo.svg
       style.scc                 # (файлы статики)

  templates/                     # Jinja2 шаблоны для web_app
    base.html                    # Общий каркас сайта (layout)
    index.html                   # Главная страница / форма поиска
    results_keyword.html         # Шаблон результатов поиска по ключевому слову
    results_genre.html           # Шаблон результатов поиска по жанру/годам
    stats.html                   # Страница статистики (top / latest)







Ключевые результаты (что реализовано)
- Веб‑часть (Flask):
  - Маршруты: главная, поиск по ключевому слову, поиск по жанру/годам, статистика, кастомный 404.
  - Контекст‑процессор, который делает доступными во всех шаблонах настройки и справочные данные (список жанров, диапазон лет) с защитой при ошибках.
  - Валидация входных параметров, пагинация и безопасные fallback‑значения при ошибках БД.
- CLI:
  - Интерактивное меню, постраничный просмотр (paginate_loop), форматированный табличный вывод, логирование первой страницы запроса.
- Логирование:
  - Модуль для записи логов в MongoDB (log_writer), документ с полями timestamp, search_type, params, results_count.
- Форматирование:
  - Утилиты для аккуратного тексто��ого представления фильмов и списков запросов в консоли.


Основные сложности и способы их решения

1) Надёжность при недоступности внешних сервисов  
   - Проблема: отказ MySQL или MongoDB не должен ломать UX пользователя.  
   - Решение: повсеместные try/except; fallback‑значения (пустые списки, разумные min/max года), flash‑сообщения в вебе, информирование и возврат в меню в CLI.

2) Несовместимость интерфейсов модулей  
   - Проблема: mysql_connector может иметь разные сигнатуры или возвращать не тот тип данных.  
   - Решение: проверка типов возвращаемых значений (isinstance(data, dict)), fallback на пустой результат и попытка вызвать функцию с именованными аргументами, затем с позиционными (fallback при TypeError).

3) Форматирование вывода в CLI  
   - Проблема: длинные названия и вложенные структуры (params) делали вывод нечитаемым.  
   - Решение: форматтер безопасно сериализует params в JSON (ensure_ascii=False), обрезает длинные строки с многоточием, корректно выравнивает числовые колонки; рекомендована опция использовать rich для более красивого вывода.

4) Безопасность конфигурации  
   - Проблема: дефолтный SECRET_KEY = "dev" и debug=True в запуске — риск для продакшена.  
   - Решение: в README указаны рекомендации: задавать SECRET_KEY через окружение, отключать debug и запускать через WSGI (gunicorn/uWSGI), подключить централизованное логирование и мониторинг.











