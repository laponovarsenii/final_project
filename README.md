Простой сервис для поиска фильмов (данные в MySQL) с логированием поисковых запросов в MongoDB и возможностью просмотра статистики. Есть консольный интерфейс и веб-интерфейс на Flask.

Что делает каждый файл / каталог
-------------------------------

- local_settings.py  
  Хранит конфигурацию проекта: строки подключения к MySQL и MongoDB, имена баз/коллекций, PAGE_SIZE и другие константы.

- mysql_connector.py  
  Обёртка для работы с MySQL. Выполняет поисковые запросы и возвращает результаты с метаданными.
  Основные функции (ожидаемые):
  - `search_by_keyword(q, limit, offset)` — поиск по части названия, возвращает dict с keys: `results`, `total_count`, `has_next`.
  - `search_by_genre_year(genre, y_from, y_to, limit, offset)` — поиск по жанру и годам.
  - `get_all_genres()` — список доступных жанров.
  - `get_year_range()` — минимальный и мак��имальный год в базе.

- formatter.py  
  Утилиты для презентации результатов в консоли:
  - `format_films_table(rows)` — форматированная табличка фильмов (№, Название, Год, Рейтинг, Жанр).
  - `format_queries_list(rows)` — вывод списка популярных/последних запросов.

- log_writer.py  
  Запись логов поисковых запросов в MongoDB.
  - `get_collection()` — подключение к MongoDB (по `local_settings`).
  - `log_query(search_type, params, results_count)` — вставляет документ с полями `timestamp` (UTC ISO), `search_type`, `params`, `results_count`. Ошибки вставки обрабатываются и логируются/печатаются, не ломая основной поток.

- log_stats.py  
  Чтение и агрегирование статистики из MongoDB:
  - `get_top_popular(limit=5)` — топ-N популярных запросов (группировка по `(search_type, params)` и подсчёт).
  - `get_latest_unique(limit=5)` — N последних уникальных запросов (по паре `search_type+params`, берётся последняя запись).

- CLI-скрипт (например `cli.py`)  
  Консольное приложение для интерактивного поиска:
  - Функции ввода: `input_str`, `input_int`.
  - `paginate_loop(fetch_page_func, params_for_log, search_type)` — универсальная пагинация и логирование (логируется только первая страница).
  - Режимы: `search_by_keyword()`, `search_by_genre_year()`.
  - Команды для просмотра статистики: `show_popular()`, `show_latest()`.

- app.py  
  Flask-приложение (веб-интерфейс):
  - Контекст-процессор: подаёт в шаблоны `genres`, `min_year`, `max_year`, `settings`.
  - Маршруты:
    - `/` — главная форма поиска.
    - `/search/keyword` — обработка GET-параметров `q` и `page`, поиск и отображение результатов, логирование первой страницы.
    - `/search/genre` — обработка `genre`, `y_from`, `y_to`, `page`, валидация, поиск, логирование.
    - `/stats` — отображение топ-5 популярных и 5 последних уникальных запросов.
  - Обработка ошибок через `flash` и редиректы; логирование ошибок логирования безопасно подавляется.

- templates/  
  Папка с HTML-шаблонами для Flask:
  - Ожидаемые шаблоны: `index.html`, `results_keyword.html`, `results_genre.html`, `stats.html`, `base.html` и т. п.

- static/  
  Статические ресурсы веб-интерфейса: CSS изображения.

Короткие замечания по работе
---------------------------
- Логирование в MongoDB делается только для первой страницы результатов (чтобы не дублировать записи при перелистывании).
- Формат записи лога: `{ "timestamp": "YYYY-MM-DDTHH:MM:SS", "search_type": "...", "params": {...}, "results_count": N }`.
- Функции поиска должны возвращать структуру с полями `results`, `total_count`, `has_next` для корректной работы пагинации и отображения.
