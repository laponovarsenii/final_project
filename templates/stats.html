<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Статистика</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Статистика</h1>
          <small>MongoDB: только запросы keyword</small>
        </div>
      </div>

      <div class="nav">
        <a href="{{ url_for('index') }}">На главную</a>
        <button id="theme-toggle" class="btn ghost" type="button" aria-label="Переключить тему">
          <span class="icon-sun" aria-hidden="true"></span>
          <span class="icon-moon" aria-hidden="true"></span>
          Тема
        </button>
      </div>
    </div>

    {% if mongo_down %}
      <div class="card">
        <span class="badge warn"><span class="dot"></span> MongoDB недоступна — показывать нечего</span>
        <div class="sep"></div>
        <p class="muted">
          Проверьте переменную окружения <span style="font-family:var(--mono)">MONGO_URI</span>
          и доступность базы по сети.
        </p>
      </div>
    {% endif %}

    <div class="grid">
      <section class="card half">
        <h3>Топ популярных (по словам)</h3>
        {% set found = false %}
        <ul class="list">
          {% for r in popular %}
            {% if r._id.search_type == 'keyword' and r._id.params and r._id.params.keyword %}
              {% set found = true %}
              <li>
                <span class="pill">{{ r._id.params.keyword }}</span>
                — <b style="color:var(--text)">{{ r.count }}</b> раз(а)
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% if not found %}
          <p class="muted">Нет данных по запросам по словам.</p>
        {% endif %}
      </section>

      <section class="card half">
        <h3>Последние (по словам)</h3>
        {% set found2 = false %}
        <ul class="list">
          {% for r in latest %}
            {% if r.search_type == 'keyword' and r.params and r.params.keyword %}
              {% set found2 = true %}
              <li>
                <span class="pill">{{ r.params.keyword }}</span>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% if not found2 %}
          <p class="muted">Нет последних запросов по словам.</p>
        {% endif %}
      </section>
    </div>

    <div class="footer">Данные берутся из коллекции <span style="font-family:var(--mono)">search_logs</span>.</div>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>